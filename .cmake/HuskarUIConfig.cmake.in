# HuskarUI CMake 配置文件
# 此文件由 HuskarUI 库自动生成，用于在 CMake 项目中查找和使用 HuskarUI 库

# 设置版本信息
set(HuskarUI_VERSION_MAJOR @HUSKARUI_VERSION_MAJOR@)
set(HuskarUI_VERSION_MINOR @HUSKARUI_VERSION_MINOR@)
set(HuskarUI_VERSION_PATCH @HUSKARUI_VERSION_PATCH@)
set(HuskarUI_VERSION_REVISION @HUSKARUI_VERSION_TWEAK@)

set(HuskarUI_VERSION "${HuskarUI_VERSION_MAJOR}.${HuskarUI_VERSION_MINOR}.${HuskarUI_VERSION_PATCH}.${HuskarUI_VERSION_REVISION}")

# 设置库的安装前缀
# 首先尝试使用 HUSKARUI_ROOT 环境变量
if(DEFINED ENV{HUSKARUI_ROOT})
    set(_HuskarUI_INSTALL_PREFIX "$ENV{HUSKARUI_ROOT}")
    message(STATUS "Using HUSKARUI_ROOT environment variable: ${_HuskarUI_INSTALL_PREFIX}")
else()
    # 如果没有设置环境变量，使用相对路径
    get_filename_component(_HuskarUI_CMAKE_DIR "${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)
    get_filename_component(_HuskarUI_INSTALL_PREFIX "${_HuskarUI_CMAKE_DIR}/../../.." ABSOLUTE)
    message(STATUS "Using relative path to calculate install prefix: ${_HuskarUI_INSTALL_PREFIX}")
endif()

# 设置库的包含目录
set(HuskarUI_INCLUDE_DIRS "${_HuskarUI_INSTALL_PREFIX}/include")

# 设置库的库目录
set(HuskarUI_LIBRARY_DIRS "${_HuskarUI_INSTALL_PREFIX}/lib")

# 设置 QML 导入目录
set(HuskarUI_QML_IMPORT_PATH "${_HuskarUI_INSTALL_PREFIX}/qml")

# 查找 Qt6 包
find_package(Qt6 REQUIRED COMPONENTS Core Quick)

# 导入目标文件
if(NOT TARGET HuskarUI::Basic)
    include("${_HuskarUI_INSTALL_PREFIX}/lib/cmake/HuskarUI/HuskarUITargets.cmake")
endif()

# 导出 HuskarUI_import_plugin 函数
if(TARGET HuskarUI::Basic)
    # 导出插件导入函数
    function(HuskarUI_import_plugin target)
        if(TARGET HuskarUI::Basic)
            # 调用目标文件中的函数
            _HuskarUI_import_plugin_internal(${target})
        else()
            message(WARNING "HuskarUI::Basic target not available, cannot import plugin")
        endif()
    endfunction()
endif()

# 检查所有必需组件是否已找到
include(CMakeFindDependencyMacro)

# 宏：设置 HuskarUI 库的使用选项
macro(huskarui_setup_target target)
    if(TARGET ${target})
        # 添加包含目录
        target_include_directories(${target} PRIVATE ${HuskarUI_INCLUDE_DIRS})

        # 添加库目录
        target_link_directories(${target} PRIVATE ${HuskarUI_LIBRARY_DIRS})

        # 链接 HuskarUI 库
        target_link_libraries(${target} PRIVATE HuskarUI::Basic)

        # 设置 QML 导入路径
        if(Qt6_FOUND)
            target_compile_definitions(${target} PRIVATE
                -DQML_IMPORT_PATH_HUSKARUI="${HuskarUI_QML_IMPORT_PATH}"
            )
        endif()

        message(STATUS "HuskarUI library successfully configured for target: ${target}")
    else()
        message(WARNING "Target ${target} does not exist, cannot configure HuskarUI library")
    endif()
endmacro()

# 宏：自动配置 QML 导入路径
macro(huskarui_setup_qml_imports)
    if(Qt6_FOUND)
        # 设置 QML 模块导入路径
        set(CMAKE_AUTOMOC ON)
        set(CMAKE_AUTORCC ON)
        set(CMAKE_AUTOUIC ON)

        message(STATUS "HuskarUI QML import path set: ${HuskarUI_QML_IMPORT_PATH}")
    endif()
endmacro()

# 检查库是否可用
if(EXISTS "${HuskarUI_INCLUDE_DIRS}/HuskarUI/husapp.h" AND
   (EXISTS "${HuskarUI_LIBRARY_DIRS}/HuskarUIBasic.lib" OR EXISTS "${HuskarUI_LIBRARY_DIRS}/HuskarUIBasicd.lib"))
    set(HuskarUI_FOUND TRUE)
    message(STATUS "HuskarUI library found: ${HuskarUI_VERSION}")
    message(STATUS "  - Include directories: ${HuskarUI_INCLUDE_DIRS}")
    message(STATUS "  - Library directories: ${HuskarUI_LIBRARY_DIRS}")
    message(STATUS "  - QML import path: ${HuskarUI_QML_IMPORT_PATH}")
else()
    set(HuskarUI_FOUND FALSE)
    if(HuskarUI_FIND_REQUIRED)
        message(FATAL_ERROR "HuskarUI library not found")
    else()
        message(WARNING "HuskarUI library not found")
    endif()
endif()
